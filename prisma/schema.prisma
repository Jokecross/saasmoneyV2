// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================
// USER & AUTH
// ============================================

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String
  name          String
  avatar        String?
  role          String   @default("user") // user, admin
  coinsBalance  Int      @default(100)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  conversations    Conversation[]
  coinsTransactions CoinTransaction[]
  oneOfOneBookings OneOfOneBooking[]
  hotsetBookings   HotsetBooking[]
}

// ============================================
// SAAS MONEY - IA CHAT
// ============================================

model Conversation {
  id        String   @id @default(cuid())
  title     String   @default("Nouvelle conversation")
  mode      String   @default("coach") // coach, growth, produit, copywriting
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages Message[]
}

model Message {
  id             String   @id @default(cuid())
  content        String
  role           String   // user, assistant
  conversationId String
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
}

// ============================================
// ONE OF ONE CALLS - COINS SYSTEM
// ============================================

model CoinTransaction {
  id        String   @id @default(cuid())
  userId    String
  amount    Int      // positive for credit, negative for debit
  type      String   // credit, debit
  reason    String   // purchase, booking, refund, bonus
  metadata  String?  // JSON string for additional info
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model OneOfOneSlot {
  id          String   @id @default(cuid())
  date        DateTime
  duration    Int      @default(30) // in minutes
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  bookings OneOfOneBooking[]
}

model OneOfOneBooking {
  id        String   @id @default(cuid())
  userId    String
  slotId    String
  coinsSpent Int
  status    String   @default("confirmed") // confirmed, cancelled, completed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  slot OneOfOneSlot @relation(fields: [slotId], references: [id], onDelete: Cascade)
}

// ============================================
// HOTSET BOOKINGS
// ============================================

model HotsetType {
  id          String   @id @default(cuid())
  name        String
  description String
  duration    Int      @default(60) // in minutes
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  slots HotsetSlot[]
}

model HotsetSlot {
  id          String   @id @default(cuid())
  typeId      String
  date        DateTime
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  type     HotsetType      @relation(fields: [typeId], references: [id], onDelete: Cascade)
  bookings HotsetBooking[]
}

model HotsetBooking {
  id        String   @id @default(cuid())
  userId    String
  slotId    String
  status    String   @default("confirmed") // confirmed, cancelled, completed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  slot HotsetSlot @relation(fields: [slotId], references: [id], onDelete: Cascade)
}

// ============================================
// ADMIN SETTINGS
// ============================================

model AppSettings {
  id              String   @id @default(cuid())
  oneOfOneCost    Int      @default(50) // coins per call
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

